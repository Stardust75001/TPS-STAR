{%- comment -%}
  Section produit unique - Version corrigée (images: main eager, thumbs lazy)
{%- endcomment -%}

<div class="single-product-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 mb-4">
        {% if product.images.size > 0 %}
          <div class="product-gallery">
            <div class="main-image">
              <img
                src="{{ product.featured_image | img_url: '1600x' }}"
                alt="{{ product.title | escape }}"
                width="{{ product.featured_image.width | default: 1600 }}"
                height="{{ product.featured_image.height | default: 1600 }}"
                class="img-fluid rounded"
                loading="eager"
                fetchpriority="high"
                decoding="async"
              >
            </div>
            {% if product.images.size > 1 %}
              <div class="thumbnail-images mt-3">
                {% for image in product.images limit: 4 %}
                  <img
                    src="{{ image | img_url: '150x150' }}"
                    alt="{{ product.title | escape }}"
                    class="img-thumbnail me-2"
                    width="80"
                    height="80"
                    loading="lazy"
                    decoding="async"
                    style="width: 80px; height: 80px; object-fit: cover;"
                  >
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% else %}
          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg img-fluid' }}
        {% endif %}

        {%- assign first_image = true -%}
        {%- if product.media.size > 0 -%}
          {%- for media in product.media -%}
            {%- if first_image -%}
              {%- assign _loading = 'eager' -%}
              {%- assign _priority = 'high' -%}
              {%- assign first_image = false -%}
            {%- else -%}
              {%- assign _loading = 'lazy' -%}
              {%- assign _priority = 'auto' -%}
            {%- endif -%}

            <img
              src="{{ media | image_url: width: 1600 }}"
              alt="{{ media.alt | escape }}"
              width="{{ media.width }}"
              height="{{ media.height }}"
              loading="{{ _loading }}"
              fetchpriority="{{ _priority }}"
              decoding="async"
            >
          {%- endfor -%}
        {%- endif -%}
      </div>

      <div class="col-lg-6">
        <div class="product-info">
          {% if product.vendor != blank %}
            <p class="vendor text-muted mb-2">{{ product.vendor }}</p>
          {% endif %}

          <h1 class="product-title h2 mb-3">{{ product.title }}</h1>

          <div class="price-section mb-4">
            <span class="price h4 text-primary">
              {{ product.price | money }}
            </span>
            {% if product.compare_at_price > product.price %}
              <span class="compare-price text-muted text-decoration-line-through ms-2">
                {{ product.compare_at_price | money }}
              </span>
            {% endif %}
          </div>

          {% if product.description != blank %}
            <div class="product-description mb-4">
              {{ product.description }}
            </div>
          {% endif %}

          {% form 'product', product %}
            <input
              type="hidden"
              name="id"
              value="{{ product.selected_or_first_available_variant.id }}"
            >

            {% if product.variants.size > 1 %}
              <div class="product-variants mb-3">
                {% for option in product.options_with_values %}
                  <div class="variant-option mb-2">
                    <label class="form-label">{{ option.name }}</label>
                    <select class="form-select" name="options[{{ option.name }}]">
                      {% for value in option.values %}
                        <option value="{{ value }}">{{ value }}</option>
                      {% endfor %}
                    </select>
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            <div class="add-to-cart-section">
              <div class="quantity-selector mb-3">
                <label class="form-label">Quantité</label>
                <input
                  type="number"
                  name="quantity"
                  value="1"
                  min="1"
                  class="form-control"
                  style="width: 100px;"
                >
              </div>

              <button type="submit" class="btn btn-primary btn-lg w-100">
                <i class="fas fa-shopping-cart me-2"></i>
                Ajouter au panier
              </button>
            </div>
          {% endform %}
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Produit unique",
  "settings": [
    {
      "type": "header",
      "content": "Configuration générale"
    },
    {
      "type": "text",
      "id": "container",
      "label": "Classe container",
      "default": "container"
    },
    {
      "type": "range",
      "id": "pt",
      "label": "Padding top",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 5
    },
    {
      "type": "range",
      "id": "pb",
      "label": "Padding bottom",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 5
    }
  ],
  "presets": [
    {
      "name": "Produit unique"
    }
  ]
}
{% endschema %}
