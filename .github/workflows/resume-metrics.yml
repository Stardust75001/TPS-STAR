name: ðŸ§¾ Resume Metrics Summary

on:
  workflow_dispatch:
  schedule:
    - cron: "0 8 * * 1" # chaque lundi Ã  8h

jobs:
  resume-metrics:
    runs-on: ubuntu-latest
    name: ðŸ§  Resume Metrics
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: ðŸ“Š Generate metrics summary
        id: summary
        run: |
          echo "<h3>THE PET SOCIETY â€” Metrics Summary</h3>" > summary.html
          echo "<ul>" >> summary.html
          echo "<li>âœ… Sentry DSN: <code>${{ secrets.SENTRY_DSN }}</code></li>" >> summary.html
          echo "<li>âœ… Cloudflare Token: OK</li>" >> summary.html
          echo "<li>âœ… Ahrefs API: OK</li>" >> summary.html
          echo "<li>âœ… Slack Webhook: OK</li>" >> summary.html
          echo "<li>âœ… GA4 Refresh Token: OK</li>" >> summary.html
          echo "<li>âœ… Meta Pixel / Shopify Integrations: OK</li>" >> summary.html
          echo "</ul>" >> summary.html

      - name: ðŸ’¬ Send summary to Slack
        run: |
          TEXT=$(cat summary.html | sed 's/"/\\"/g' | tr -d '\n')
          curl -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"ðŸ§© *Metrics Summary* \\n ${TEXT}\"}" \
          "${{ secrets.SLACK_WEBHOOK_URL }}"

      - name: ðŸ“§ (Optional) Send by Email
        if: ${{ secrets.SMTP_USER != '' }}
        run: |
          echo "Sending metrics summary via email..."
          echo "Subject: THE PET SOCIETY â€” Metrics Summary
From: ${{ secrets.SMTP_USER }}
To: ${{ secrets.EMAIL_RECIPIENT }}
Content-Type: text/html

$(cat summary.html)" | sendmail -t
