name: ğŸ” Verify Metrics Connections

on:
  workflow_dispatch:

jobs:
  verify-metrics:
    runs-on: ubuntu-latest
    name: ğŸ”§ Test all Metrics APIs
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ” Test Sentry DSN
        run: |
          echo "Testing Sentry..."
          curl -s -o /dev/null -w "%{http_code}" "${{ secrets.SENTRY_DSN }}" || echo "âŒ Sentry DSN failed"

      - name: ğŸ” Test Cloudflare Token
        run: |
          echo "Testing Cloudflare..."
          curl -s -o /dev/null -w "%{http_code}" "https://api.cloudflare.com/client/v4/user/tokens/verify" \
          -H "Authorization: Bearer ${{ secrets.CLOUDFLARE_TOKEN }}" || echo "âŒ Cloudflare Token failed"

      - name: ğŸ” Test Ahrefs API
        run: |
          echo "Testing Ahrefs..."
          curl -s -o /dev/null -w "%{http_code}" \
          "https://api.ahrefs.com/v3/site-explorer/domain-rating?target=thepetsociety.paris&mode=domain" \
          -H "Authorization: Bearer ${{ secrets.AHREFS_API_KEY }}" || echo "âŒ Ahrefs failed"

      - name: ğŸ” Test Slack Webhook
        run: |
          echo "Testing Slack..."
          curl -X POST -H 'Content-type: application/json' \
          --data '{"text":":white_check_mark: Slack webhook active"}' \
          "${{ secrets.SLACK_WEBHOOK_URL }}" || echo "âŒ Slack failed"

      - name: ğŸ” Test GA4 Refresh Token
        run: |
          echo "Testing GA4 token..."
          if [ -n "${{ secrets.GA4_REFRESH_TOKEN }}" ]; then
            echo "âœ… GA4 Refresh Token exists"
          else
            echo "âŒ GA4 Refresh Token missing"
          fi

      - name: âœ… Summary
        run: echo "All metrics tested. Check results above."
