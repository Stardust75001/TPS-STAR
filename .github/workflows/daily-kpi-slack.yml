name: ðŸ“Š Daily KPI Dashboard â†’ Slack

on:
  schedule:
    - cron: "0 6 * * *"   # Tous les jours Ã  06:00 Paris
  workflow_dispatch:

jobs:
  send_report:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Generate Daily KPI (placeholder)
        run: |
          echo "TPS Daily KPI Report" > report.txt
          echo "ðŸ›’ Sales: N/A" >> report.txt
          echo "ðŸ“¦ Orders: N/A" >> report.txt
          echo "ðŸ‘¤ Users: N/A" >> report.txt
          echo "âš¡ Performance: N/A" >> report.txt

      - name: Send KPI to Slack
        run: |
          WEBHOOK="${{ secrets.SLACK_WEBHOOK_URL }}"
          MESSAGE=$(cat report.txt | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')

          curl -X POST -H 'Content-type: application/json' \
            --data "{\"text\": \"ðŸ“Š *TPS â€” Daily KPI Dashboard*\\n\\n$MESSAGE\"}" \
            "$WEBHOOK"
